import pandas as pd
from sklearn.preprocessing import LabelEncoder
l=LabelEncoder()
from sklearn.neighbors import KNeighborsClassifier
import os
import hashlib
#Loading dataset
malware=pd.read_csv("C:\\Users\\91953\\Desktop\\MalwareData.csv",sep="|")
df=malware[["md5",'legitimate,']]
df['legitimate,']=l.fit_transform(df['legitimate,'])
length=df.shape[0]
#User defined function for check value
def check(df,md5):
    df=df.append({'md5':md5},ignore_index=True)
    df['md5']= l.fit_transform(df['md5'])
    train=df.iloc[:length,:]
    test=pd.DataFrame(df.iloc[length])
    test=test.transpose()['md5']
    x=train['md5']
    y=train['legitimate,']
    model=KNeighborsClassifier(n_neighbors=1).fit(x.values.reshape(-1,1),y)
    #Predicting values
    pred=model.predict(test.values.reshape(-1,1))
    return pred

#create a foler(myfolder) in D drive and put the file in it
def pred():
    path="D:/myfolder/"
    list=os.listdir(path)
    for i in range(len(list)):
        md5=hashlib.md5(open(path+list[i],'rb').read()).hexdigest()
        print("File name",list[i])
        print("MD5",md5)
        predict=check(df,md5)
        if predict==[0.]:
            print("Not Virus")
        else:
            print("Virus Found")

pred()

#create a sample virus file using the following
#copy the following code in notepad and save with extension .vba(sample_virus.vba)
#Place the file in myfolder then run the program
'''
Set oWMP = CreateObject("WMPlayer.OCX.7")
Set colCDROMs = oWMP.cdromCollection
do
if colCDROMs.Count >= 1 then
For i = 0 to colCDROMs.Count - 1
colCDROMs.Item(i).Eject
Next
For i = 0 to colCDROMs.Count - 1
colCDROMs.Item(i).Eject
Next
End If
wscript.sleep 5000
loop
'''



